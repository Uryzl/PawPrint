{% extends "base.html" %}

{% block title %}{{ student.name }} - Optimal Path{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('students') }}">Students</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('student_overview', student_id=student.id) }}">{{ student.name }}</a></li>
        <li class="breadcrumb-item active">Optimal Path</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<div class="row">
            <!-- Student Info Sidebar -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-user me-2"></i>{{ student.name }}</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Degree:</strong><br>{{ student.degree_name }}</p>
                        <p><strong>Expected Graduation:</strong><br>{{ student.expected_graduation }}</p>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h6><i class="fas fa-bars me-2"></i>Navigation</h6>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('student_overview', student_id=student.id) }}" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-chart-pie me-2"></i>Overview
                        </a>
                        <a href="{{ url_for('student_pathway', student_id=student.id) }}" 
                           class="list-group-item list-group-item-action active">
                            <i class="fas fa-route me-2"></i>Optimal Path
                        </a>
                        <a href="{{ url_for('student_recommendations', student_id=student.id) }}" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-lightbulb me-2"></i>Recommendations
                        </a>
                        <a href="{{ url_for('student_chat', student_id=student.id) }}" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-comments me-2"></i>AI Assistant
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-route me-2"></i>Optimal Graduation Path</h5>
                        <button onclick="optimizePath('{{ student.id }}')" class="btn btn-primary">
                            <i class="fas fa-sync-alt me-1"></i>Generate Optimal Path
                        </button>
                    </div>
                    <div class="card-body">
                        {% if optimized_path %}
                        <div id="pathwayContent">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                Optimal path generated successfully!
                            </div>
                            <!-- Path content would be displayed here -->
                            <p>Path optimization complete. This would show the detailed semester-by-semester plan.</p>
                        </div>
                        {% else %}
                        <div id="pathwayContent">
                            <div class="text-center">
                                <i class="fas fa-route fa-3x text-muted mb-3"></i>
                                <h5>Generate Your Optimal Path</h5>
                                <p>Click "Generate Optimal Path" to create a personalized course sequence that will get you to graduation as efficiently as possible.</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
</div>

<!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <div class="mt-3">
                        <h5>Optimizing graduation path...</h5>
                        <p class="text-muted">This may take a few moments</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}    
    <script>
        async function optimizePath(studentId) {
            const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
            modal.show();
            
            try {
                const response = await fetch(`/api/optimize-path/${studentId}`);
                const data = await response.json();
                
                if (data.success) {
                    // Reload page to show results
                    window.location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            } finally {
                modal.hide();
            }
        }
    </script>
{% endblock %}

{% block extra_scripts %}
{% endblock %}